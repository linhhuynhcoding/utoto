generator client {
  provider = "prisma-client"
  output   = "../src/prisma"
}

datasource db {
  provider = "postgresql"
}

model administrative_regions {
  id           Int         @id
  name         String      @db.VarChar(255)
  name_en      String      @db.VarChar(255)
  code_name    String?     @db.VarChar(255)
  code_name_en String?     @db.VarChar(255)
  provinces    provinces[]
}

model administrative_units {
  id            Int         @id
  full_name     String?     @db.VarChar(255)
  full_name_en  String?     @db.VarChar(255)
  short_name    String?     @db.VarChar(255)
  short_name_en String?     @db.VarChar(255)
  code_name     String?     @db.VarChar(255)
  code_name_en  String?     @db.VarChar(255)
  districts     districts[]
  provinces     provinces[]
  wards         wards[]
}

model brands {
  brand_id   BigInt       @id
  brand_name String       @db.VarChar
  logo       String       @db.VarChar
  car_models car_models[]
}

model car_features {
  car_id     String   @db.VarChar(20)
  feature_id String   @db.VarChar(10)
  cars       cars     @relation(fields: [car_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  features   features @relation(fields: [feature_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([car_id, feature_id], map: "car_features_car_id_feature_id_idx")
}

model car_images {
  car_id    String @db.VarChar(20)
  image_url String @db.VarChar
  cars      cars   @relation(fields: [car_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  images    images @relation(fields: [image_url], references: [url], onDelete: NoAction, onUpdate: NoAction)

  @@unique([car_id, image_url], map: "car_images_car_id_image_url_idx")
}

model car_models {
  model_id   BigInt @id
  brand_id   BigInt
  model_name String @db.VarChar
  brands     brands @relation(fields: [brand_id], references: [brand_id], onDelete: NoAction, onUpdate: NoAction)
  cars       cars[]
}

model cars {
  id                             String         @id @db.VarChar(20)
  owner                          String         @db.VarChar(20)
  name                           String         @db.VarChar(100)
  license_number                 String         @unique @db.VarChar(20)
  desc                           String
  model_id                       BigInt
  transmission                   String         @db.VarChar(10)
  seat                           Int
  yom                            Int            @default(2020)
  engine_type                    String         @db.VarChar(10)
  price                          Decimal        @db.Decimal(12, 2)
  priceWithPlatformFee           Decimal        @db.Decimal(12, 2)
  deliveryFee                    Decimal?       @default(0) @db.Decimal(12, 2)
  deliveryRadius                 Int?           @default(20)
  location_id                    BigInt?
  batteryChargingPerPercentPrice Decimal?       @default(0) @db.Decimal(12, 2)
  batteryChargingPrice           Decimal?       @default(0) @db.Decimal(12, 2)
  deodorisePrice                 Decimal?       @default(0) @db.Decimal(12, 2)
  washingPrice                   Decimal?       @default(0) @db.Decimal(12, 2)
  overTimePrice                  Decimal?       @default(0) @db.Decimal(12, 2)
  maxOverTimeHour                Int?           @default(5)
  is_self_driving                Boolean        @default(true)
  is_with_driver                 Boolean        @default(false)
  is_long_term                   Boolean        @default(false)
  car_features                   car_features[]
  car_images                     car_images[]
  locations                      locations?     @relation(fields: [location_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  car_models                     car_models     @relation(fields: [model_id], references: [model_id], onDelete: NoAction, onUpdate: NoAction)
  users                          users          @relation(fields: [owner], references: [id], onDelete: NoAction, onUpdate: NoAction)
  trips                          trips[]
  gps_events                     gps_events[]
}

model districts {
  code                   String                @id @db.VarChar(20)
  name                   String                @db.VarChar(255)
  name_en                String?               @db.VarChar(255)
  full_name              String?               @db.VarChar(255)
  full_name_en           String?               @db.VarChar(255)
  code_name              String?               @db.VarChar(255)
  province_code          String?               @db.VarChar(20)
  administrative_unit_id Int?
  administrative_units   administrative_units? @relation(fields: [administrative_unit_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  provinces              provinces?            @relation(fields: [province_code], references: [code], onDelete: NoAction, onUpdate: NoAction)
  wards                  wards[]
  locations              locations[]

  @@index([province_code], map: "idx_districts_province")
  @@index([administrative_unit_id], map: "idx_districts_unit")
}

model features {
  id           String         @id @db.VarChar(10)
  logo         String?        @db.VarChar
  name         String?        @db.VarChar(100)
  car_features car_features[]
}

model images {
  url        String       @id @db.VarChar
  width      Int
  height     Int
  desc       String?
  car_images car_images[]
}

model locations {
  id            BigInt    @id @default(autoincrement())
  lat           Float?
  lon           Float?
  ward_id       String    @db.VarChar(20)
  district_id   String    @db.VarChar(20)
  province_id   String    @db.VarChar(20)
  street        String    @db.VarChar(100)
  short_address String?   @db.VarChar(100)
  cars          cars[]
  users         users[]
  provinces     provinces @relation(fields: [province_id], references: [code], onDelete: NoAction, onUpdate: NoAction)
  districts     districts @relation(fields: [district_id], references: [code], onDelete: NoAction, onUpdate: NoAction)
  wards         wards     @relation(fields: [ward_id], references: [code], onDelete: NoAction, onUpdate: NoAction)
}

model payments {
  payment_id  BigInt    @id
  status      String    @default("PENDING") @db.VarChar
  amount      Decimal?  @db.Decimal(12, 2)
  pay_at      DateTime? @db.Timestamp(6)
  tx_id_sepay String?   @db.VarChar
  trips       trips[]
}

model provinces {
  code                     String                  @id @db.VarChar(20)
  name                     String                  @db.VarChar(255)
  name_en                  String?                 @db.VarChar(255)
  full_name                String                  @db.VarChar(255)
  full_name_en             String?                 @db.VarChar(255)
  code_name                String?                 @db.VarChar(255)
  administrative_unit_id   Int?
  administrative_region_id Int?
  districts                districts[]
  administrative_regions   administrative_regions? @relation(fields: [administrative_region_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  administrative_units     administrative_units?   @relation(fields: [administrative_unit_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  locations                locations[]

  @@index([administrative_region_id], map: "idx_provinces_region")
  @@index([administrative_unit_id], map: "idx_provinces_unit")
}

model trips {
  trip_id     String    @id @db.VarChar(20)
  renter_id   String    @db.VarChar(20)
  car_id      String    @db.VarChar(20)
  status      String    @db.VarChar(20)
  from_date   DateTime  @db.Timestamp(6)
  to_date     DateTime  @db.Timestamp(6)
  ship_method Int       @default(1)
  ship_fee    Decimal?  @db.Decimal(12, 2)
  rent_amount Decimal   @db.Decimal(12, 2)
  payment_id  BigInt?
  cars        cars      @relation(fields: [car_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  payments    payments? @relation(fields: [payment_id], references: [payment_id], onDelete: NoAction, onUpdate: NoAction)
  users       users     @relation(fields: [renter_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model users {
  id                         String     @id @db.VarChar(20)
  name                       String     @db.VarChar(50)
  email                      String     @db.VarChar
  phone_number               String     @db.VarChar(20)
  phone_code                 String     @db.VarChar(20)
  dob                        DateTime?  @db.Date
  address_id                 BigInt?
  avatar                     String?    @db.VarChar
  isVerified                 Boolean    @default(false)
  driver_license_code        String?    @db.VarChar
  driver_license_name        String?    @db.VarChar
  driver_license_dob         String?    @db.VarChar
  driver_license_class       String?    @db.VarChar
  driver_license_issue_date  String?    @db.VarChar
  driver_license_expiry_date String?    @db.VarChar
  driver_license_image_front String?    @db.VarChar
  driver_license_image_back  String?    @db.VarChar
  cars                       cars[]
  trips                      trips[]
  locations                  locations? @relation(fields: [address_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model wards {
  code                   String                @id @db.VarChar(20)
  name                   String                @db.VarChar(255)
  name_en                String?               @db.VarChar(255)
  full_name              String?               @db.VarChar(255)
  full_name_en           String?               @db.VarChar(255)
  code_name              String?               @db.VarChar(255)
  district_code          String?               @db.VarChar(20)
  administrative_unit_id Int?
  administrative_units   administrative_units? @relation(fields: [administrative_unit_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  districts              districts?            @relation(fields: [district_code], references: [code], onDelete: NoAction, onUpdate: NoAction)
  locations              locations[]

  @@index([district_code], map: "idx_wards_district")
  @@index([administrative_unit_id], map: "idx_wards_unit")
}

model gps_events {
  id             String   @id @default(uuid())
  car_id         String   @db.VarChar(20)
  license_number String   @db.VarChar(20)
  lat            Float
  lng            Float
  speed          Float?
  distance       Float?
  total_distance Float?
  state          String?  @db.VarChar(20)
  behavior       String?  @db.VarChar(20)
  timestamp      DateTime @default(now()) @db.Timestamp(6)
  created_at     DateTime @default(now()) @db.Timestamp(6)
  cars           cars     @relation(fields: [car_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([car_id])
  @@index([timestamp])
}
